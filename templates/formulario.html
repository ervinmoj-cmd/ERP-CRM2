<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8">
  <title>InAIR ¬∑ Reporte t√©cnico</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background: #f7f7fb
    }

    .card {
      border-radius: 16px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, .06)
    }

    .section-title {
      font-weight: 700;
      font-size: 1.05rem
    }

    .sig-box {
      background: #fff;
      border: 1px solid #e6e6e6;
      border-radius: 10px
    }

    .table-sm td,
    .table-sm th {
      padding: .35rem .5rem;
      font-size: .9rem
    }

    .grid-compact input {
      height: 32px;
    }

    .sticky-title {
      position: sticky;
      top: 0;
      background: #fff;
      z-index: 2
    }

    /* ====== MEJORAS EN M√ìVIL ====== */
    @media (max-width: 576px) {
      body {
        background: #fff;
      }

      .card {
        border-radius: 12px;
        box-shadow: none;
      }

      /* Filas de ‚ÄúLecturas‚Äù: apila etiqueta y campos */
      .row.align-items-center>.col-8,
      .row.align-items-center>.col-4 {
        flex: 0 0 100%;
        max-width: 100%;
      }

      .row.align-items-center {
        margin-bottom: .35rem;
      }

      /* Inputs compactos */
      .form-control,
      .form-select {
        height: 38px;
        padding: .35rem .5rem;
      }

      .form-control.form-control-sm,
      .form-select.form-select-sm {
        height: 34px;
      }

      /* Tablas con scroll horizontal suave */
      .table-responsive {
        -webkit-overflow-scrolling: touch;
      }

      /* Firma m√°s alta en m√≥vil */
      .sig-box canvas {
        height: 160px !important;
      }

      /* Datos el√©ctricos: apilar input y dropdown verticalmente */
      .input-group {
        flex-direction: column;
      }

      .input-group .form-control,
      .input-group .form-select {
        width: 100% !important;
        max-width: 100% !important;
        border-radius: 6px !important;
        margin-bottom: 4px;
      }
    }

    /* Evita que celdas/inputs se "aplasten" en tablet */
    @media (min-width: 577px) and (max-width: 992px) {

      .form-control,
      .form-select {
        height: 40px;
      }
    }

    /* ====== NAVEGACI√ìN POR SECCIONES EN M√ìVIL/TABLET ====== */
    
    /* Desktop: todo visible, sin navegaci√≥n por pasos */
    @media (min-width: 993px) {
      .mobile-section-nav {
        display: none !important;
      }
      .form-section-step {
        display: block !important;
      }
    }

    /* M√≥vil y Tablet: navegaci√≥n por secciones */
    @media (max-width: 992px) {
      /* Header fijo arriba */
      .report-header-fixed {
        position: sticky;
        top: 0;
        z-index: 100;
        background: #fff;
        padding: 15px;
        margin: -16px -16px 0 -16px;
        border-bottom: 1px solid #e0e0e0;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      }

      /* Ocultar todas las secciones por defecto */
      .form-section-step {
        display: none;
      }

      /* Mostrar solo la secci√≥n activa */
      .form-section-step.active {
        display: block;
        animation: fadeInSection 0.3s ease;
      }

      @keyframes fadeInSection {
        from { opacity: 0; transform: translateX(10px); }
        to { opacity: 1; transform: translateX(0); }
      }

      /* Barra de navegaci√≥n inferior */
      .mobile-section-nav {
        display: flex !important;
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: #fff;
        padding: 12px 15px;
        border-top: 1px solid #e0e0e0;
        box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        z-index: 1000;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
      }

      .mobile-section-nav .btn {
        flex: 1;
        max-width: 140px;
      }

      .mobile-section-nav .section-indicator {
        font-weight: 600;
        color: #666;
        font-size: 0.9em;
        text-align: center;
        white-space: nowrap;
      }

      .mobile-section-nav .btn-prev:disabled {
        opacity: 0.4;
      }

      /* Espacio inferior para no tapar contenido con la nav fija */
      .mobile-form-container {
        padding-bottom: 80px;
      }

      /* T√≠tulo de secci√≥n en m√≥vil */
      .mobile-section-title {
        background: linear-gradient(135deg, #d20000, #ff4444);
        color: white;
        padding: 12px 15px;
        margin: -16px -16px 20px -16px;
        font-weight: 600;
        font-size: 1.1em;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .mobile-section-title .section-number {
        background: rgba(255,255,255,0.2);
        width: 28px;
        height: 28px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9em;
      }

      /* Ocultar botones finales en m√≥vil (se usa el nav) */
      .desktop-only-buttons {
        display: none !important;
      }
    }

    /* Tablet espec√≠fico */
    @media (min-width: 577px) and (max-width: 992px) {
      .mobile-section-nav .btn {
        max-width: 180px;
        padding: 12px 20px;
      }
    }
  </style>
</head>

<body>
  <div class="container py-4">
    <div class="card p-3 mb-4 mobile-form-container">
      <!-- Header fijo en m√≥vil -->
      <div class="report-header-fixed">
        <div class="d-flex align-items-center justify-content-between gap-3 flex-wrap">
          <div class="d-flex align-items-center gap-3">
            <img src="{{ url_for('static', filename='img/logo_inair.png') }}" alt="InAIR" style="height:40px">
            <div>
              <div class="fw-bold">REPORTE T√âCNICO</div>
              <div class="text-muted small">
                Folio: <span class="text-danger fw-bold">{{ folio }}</span>
              </div>
            </div>
          </div>
          <div class="d-flex gap-2 flex-wrap">
            <form action="{{ url_for('nuevo_folio') }}" method="post" class="d-inline">
              <button class="btn btn-primary btn-sm" type="submit">Nuevo reporte</button>
            </form>
            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="history.back()">Atr√°s</button>
            <a href="{{ url_for('dashboard_redirect') }}" class="btn btn-secondary btn-sm">Volver al Panel</a>
            <a href="{{ url_for('logout') }}" class="btn btn-danger btn-sm">Cerrar Sesi√≥n</a>
          </div>
        </div>
      </div>


      <!-- ‚úÖ id="frm-reporte" necesario para auto-guardado -->
      <form id="frm-reporte" action="{{ url_for('generar_pdf') }}" method="post" enctype="multipart/form-data"
        class="card p-4 mb-5">
        <input type="hidden" name="folio" value="{{ folio }}">
        <input type="hidden" name="tecnico" value="{{ session.get('user_nombre','') }}">
        {% if deal_id %}
        <input type="hidden" name="deal_id" value="{{ deal_id }}">
        {% endif %}

        <!-- ========== SECCI√ìN 1: Fecha, Localidad, Datos del cliente ========== -->
        <div class="form-section-step active" data-section="1">
          <div class="mobile-section-title d-none d-block d-lg-none">
            <span class="section-number">1</span> Informaci√≥n General
          </div>
          
          <!-- Fecha + Localidad -->
          <div class="row g-3 mb-3">
            <div class="col-12 col-sm-4">
              <label class="form-label fw-bold">Fecha</label>
              <input type="date" class="form-control" name="fecha" required>
            </div>
            <div class="col-12 col-sm-4">
              <label class="form-label fw-bold">Localidad</label>
              <select class="form-select" name="localidad" required>
                <option value="Mexicali">Mexicali</option>
                <option value="Tijuana">Tijuana</option>
              </select>
            </div>
          </div>

          <!-- Datos del cliente -->
          <div class="mb-4">
            <div class="section-title mb-2">Datos del cliente</div>
            <div class="row g-3">
              <div class="col-12 col-md-6">
                <label class="form-label">Cliente</label>
                <input type="hidden" id="cliente_id" name="cliente_id">
                <div class="d-flex gap-2">
                  <select class="form-select" id="cliente_select" name="cliente_select">
                    <option value="">Seleccione un cliente...</option>
                  </select>
                  <input class="form-control" id="cliente_input" name="cliente" style="display:none;" disabled
                    placeholder="Escriba el nombre del cliente">
                  <button type="button" class="btn btn-outline-secondary" id="toggle_manual_client"
                    title="Entrada Manual">‚úèÔ∏è</button>
                </div>
              </div>
              <div class="col-12 col-md-6">
                <label class="form-label">Contacto</label>
                <div class="d-flex gap-2">
                  <input class="form-control" id="contacto" name="contacto" readonly>
                  <button type="button" class="btn btn-outline-secondary" id="toggle_contacto" title="Editar"
                    onclick="toggleReadOnly('contacto')">üîí</button>
                </div>
              </div>
              <div class="col-12 col-md-4">
                <label class="form-label">Tel√©fono</label>
                <div class="d-flex gap-2">
                  <input class="form-control" id="telefono" name="telefono" readonly>
                  <button type="button" class="btn btn-outline-secondary" id="toggle_telefono" title="Editar"
                    onclick="toggleReadOnly('telefono')">üîí</button>
                </div>
              </div>
              <div class="col-12 col-md-8">
                <label class="form-label">Email</label>
                <div class="d-flex gap-2">
                  <input class="form-control" id="email" name="email" readonly>
                  <button type="button" class="btn btn-outline-secondary" id="toggle_email" title="Editar"
                    onclick="toggleReadOnly('email')">üîí</button>
                </div>
              </div>
              <div class="col-12">
                <label class="form-label">Direcci√≥n</label>
                <div class="d-flex gap-2">
                  <input class="form-control" id="direccion" name="direccion" readonly>
                  <button type="button" class="btn btn-outline-secondary" id="toggle_direccion" title="Editar"
                    onclick="toggleReadOnly('direccion')">üîí</button>
                </div>
              </div>
              <div class="col-12 col-md-6">
                <label class="form-label">Vincular a Trato (Opcional)</label>
                <select class="form-select" id="deal_select" name="deal_id">
                  <option value="">No vincular a ning√∫n trato</option>
                </select>
                <div class="form-text">Seleccione un trato para vincular este reporte. Solo se muestran tratos del cliente
                  seleccionado.</div>
              </div>
            </div>
          </div>
        </div>
        <!-- ========== FIN SECCI√ìN 1 ========== -->

        <!-- ========== SECCI√ìN 2: Servicio + Datos del equipo ========== -->
        <div class="form-section-step" data-section="2">
          <div class="mobile-section-title d-none d-block d-lg-none">
            <span class="section-number">2</span> Servicio y Equipo
          </div>

          <!-- Servicio -->
          <div class="mb-4">
            <div class="section-title mb-2">Servicio</div>
            <div class="row g-3">
              <div class="col-12 col-md-4">
                <label class="form-label">Tipo de servicio</label>
                <select class="form-select" name="tipo_servicio" id="tipo_servicio">
                  <option>Preventivo</option>
                  <option>Correctivo</option>
                  <option>Diagn√≥stico</option>
                  <option>Revisi√≥n</option>
                  <option>Bit√°cora</option>
                </select>
              </div>
              <div class="col-12 col-md-8">
                <label class="form-label">Descripci√≥n del servicio</label>
                <select class="form-select" name="descripcion_servicio" id="descripcion_servicio"></select>
                <div class="form-text">Se precarga seg√∫n el tipo de servicio.</div>
              </div>
            </div>
          </div>

          <!-- Equipo -->
          <div class="mb-4">
            <div class="section-title mb-2">Datos del equipo</div>
            <div class="row g-3">
              <div class="col-12 col-md-6">
                <label class="form-label">Tipo de equipo</label>
                <div class="d-flex gap-2">
                  <select class="form-select" id="tipo_equipo_select" name="tipo_equipo_select">
                    <option value="">Seleccione tipo de equipo...</option>
                    {% for eq in lista_equipos %}<option value="{{ eq }}">{{ eq }}</option>{% endfor %}
                  </select>
                  <input class="form-control" id="tipo_equipo_input" name="tipo_equipo" style="display:none;" disabled
                    placeholder="Tipo de equipo">
                  <button type="button" class="btn btn-outline-secondary" id="toggle_tipo_equipo"
                    title="Entrada Manual">‚úèÔ∏è</button>
                </div>
              </div>
              <div class="col-12 col-md-3">
                <label class="form-label">Modelo</label>
                <div class="d-flex gap-2">
                  <select class="form-select" id="modelo_select" name="modelo_select">
                    <option value="">Seleccione modelo...</option>
                  </select>
                  <input class="form-control" id="modelo_input" name="modelo" style="display:none;" disabled
                    placeholder="Modelo">
                  <button type="button" class="btn btn-outline-secondary" id="toggle_modelo"
                    title="Entrada Manual">‚úèÔ∏è</button>
                </div>
              </div>
              <div class="col-12 col-md-3">
                <label class="form-label">Serie</label>
                <div class="d-flex gap-2">
                  <input class="form-control" id="serie_input" name="serie" placeholder="Escriba la serie">
                  <select class="form-select" id="serie_select" name="serie_select" style="display:none;" disabled>
                    <option value="">Seleccione serie...</option>
                  </select>
                  <button type="button" class="btn btn-outline-secondary" id="toggle_serie_manual"
                    title="Seleccionar de Lista">‚úèÔ∏è</button>
                </div>
              </div>
              <div class="col-12 col-md-3">
                <label class="form-label">Marca</label>
                <select class="form-select" name="marca" id="marca_select">
                  <option value="INGERSOLL RAND">Ingersoll Rand</option>
                  <option value="ATLAS COPCO">Atlas Copco</option>
                  <option value="QUINCY">Quincy</option>
                  <option value="OTROS">OTROS</option>
                </select>
                <div id="otra_marca_wrap" class="mt-2" style="display:none;">
                  <input class="form-control" type="text" name="otra_marca" placeholder="Escribe la marca">
                </div>
              </div>
              <div class="col-12 col-md-3">
                <label class="form-label">Potencia</label>
                <input class="form-control" name="potencia" placeholder="Ej. 200">
                <div class="form-text">
                  En el PDF saldr√° como <span id="potencia_unidad_hint">"HP"</span>.
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- ========== FIN SECCI√ìN 2 ========== -->

        <!-- ========== SECCI√ìN 3: Actividades ========== -->
        <div class="form-section-step" data-section="3">
          <div class="mobile-section-title d-none d-block d-lg-none">
            <span class="section-number">3</span> Actividades
          </div>

          <!-- Preventivo -->
          <div id="bloque_preventivo" class="mb-4">
          <div class="section-title mb-2">Actividades (Preventivo)</div>
          <div class="row row-cols-1 row-cols-md-2 g-2">
            {% set acts = [
            "Cambio de filtro de aire","Cambio de filtro de aceite","Cambio de elemento separador",
            "Cambio de filtro panel control","Recuperar nivel de aceite","Cambio de aceite",
            "Cambio de mangueras","Cambio v√°lvula de desfogue","Cambio v√°lvula check descarga",
            "Cambio kit v√°lvula mpcv","Cambio kit, v√°lvula admisi√≥n","Cambio v√°lvula paro de aceite",
            "Cambio kit, val. termocontrol","Cambio de bandas","Reapretar conexiones mec√°nicas",
            "Reapretar conexiones el√©ctricas","Limpieza l√≠nea de barrido","Limpieza trampa de condensados",
            "Limpieza a enfriadores aire/aceite","Revisar funcionamiento de v√°lvulas",
            "Limpieza a platinos de contactores","Lubricaci√≥n rodamiento de motor",
            "Servicio a motor el√©ctrico","Limpieza general del equipo",
            "Toma de muestra de aceite para an√°lisis"
            ] %}
            {% for a in acts %}
            <div class="col">
              <label class="form-check">
                <input class="form-check-input" type="checkbox" name="act_{{ loop.index }}">
                <span class="form-check-label">{{ a }}</span>
              </label>
            </div>
            {% endfor %}
            <div class="col-12 mt-2">
              <label class="form-label">OTRAS ACTIVIDADES</label>
              <textarea class="form-control" name="act_otras" rows="2" placeholder="Escribe aqu√≠..."></textarea>
            </div>
          </div>

          <div class="mt-3">
            <label class="form-check">
              <input class="form-check-input" type="checkbox" name="act_analisis_ruido" id="chk_ruido">
              <span class="form-check-label fw-bold">AN√ÅLISIS DE RUIDOS EN RODAMIENTOS</span>
            </label>
            <div class="row g-2 mt-1" id="ruido_opts" style="display:none;">
              <div class="col-12 col-md-3">
                <select class="form-select" name="ruido_tipo" id="ruido_tipo">
                  <option value="R30">R30</option>
                  <option value="SPM">SPM</option>
                </select>
              </div>
              <div class="col-12 col-md-9" id="ruido_r30" style="display:none;">
                <div class="row g-2">
                  <div class="col-md-4"><input class="form-control" name="ruido_resultado" placeholder="Resultado">
                  </div>
                  <div class="col-md-8"><input class="form-control" name="ruido_observaciones"
                      placeholder="Observaciones"></div>
                </div>
              </div>
            </div>

            <div id="spm_grid" class="table-responsive mt-3" style="display:none;">
              <table class="table table-bordered table-sm align-middle">
                <thead class="table-light">
                  <tr>
                    <th style="min-width:220px">AN√ÅLISIS DE RUIDO EN RODAMIENTOS (SPM)</th>
                    <th>MBRG</th>
                    <th>BG</th>
                    <th>LPMI-MRI</th>
                    <th>LPM2-MR2</th>
                    <th>HPM1</th>
                    <th>HPM2</th>
                    <th>HPF1</th>
                    <th>HPF2</th>
                    <th>LPF1</th>
                    <th>LPF2</th>
                  </tr>
                </thead>
                <tbody>
                  {% set spm_rows = [
                  ("CARGA dBm","carga_dbm"),
                  ("CARGA dBc","carga_dbc"),
                  ("CARGA dBi","carga_dbi"),
                  ("DESCARGA dbm","descarga_dbm"),
                  ("DESCARGA dBc","descarga_dbc"),
                  ("DESCARGA dBi","descarga_dbi")
                  ] %}
                  {% for row_lbl, row_key in spm_rows %}
                  <tr>
                    <th class="fw-bold">{{ row_lbl }}</th>
                    {% for col in ["mbrg","bg","lpmi_mri","lpm2_mr2","hpm1","hpm2","hpf1","hpf2","lpf1","lpf2"] %}
                    <td><input class="form-control form-control-sm" name="{{ row_key }}_{{ col }}" placeholder="N/A">
                    </td>
                    {% endfor %}
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Lecturas ¬∑ ALTA PRESI√ìN -->
        <div class="mb-4" id="card_lecturas_alta_presion" style="display:none;">
          <div class="section-title mb-2">Lecturas del equipo</div>

          <div class="card shadow-sm border-0 p-3 mb-4">
            <div class="row g-4">
              <!-- Datos generales -->
              <div class="col-12 col-lg-6">
                <div class="card p-3">
                  <div class="fw-bold mb-2">Datos generales</div>

                  <!-- 1 -->
                  <div class="row align-items-center mb-2">
                    <div class="col-8 small">Horas de operaci√≥n</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="ap_horas_operacion">
                      <select class="form-select form-select-sm unidad-select" data-tipo="horas"
                        name="ap_horas_operacion_unit"></select>
                    </div>
                  </div>
                  <!-- 2 -->
                  <div class="row align-items-center mb-2">
                    <div class="col-8 small">Presi√≥n de descarga del compresor</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="ap_presion_descarga_compresor">
                      <select class="form-select form-select-sm unidad-select" data-tipo="presion"
                        name="ap_presion_descarga_compresor_unit"></select>
                    </div>
                  </div>
                  <!-- 3 -->
                  <div class="row align-items-center mb-2">
                    <div class="col-8 small">Presi√≥n de carga del compresor</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="ap_presion_carga_compresor">
                      <select class="form-select form-select-sm unidad-select" data-tipo="presion"
                        name="ap_presion_carga_compresor_unit"></select>
                    </div>
                  </div>
                  <!-- 4 -->
                  <div class="row align-items-center mb-2">
                    <div class="col-8 small">Temperatura de entrada 1ra etapa</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="ap_temp_entrada_1ra">
                      <select class="form-select form-select-sm unidad-select" data-tipo="temp"
                        name="ap_temp_entrada_1ra_unit"></select>
                    </div>
                  </div>
                  <!-- 5 -->
                  <div class="row align-items-center mb-2">
                    <div class="col-8 small">Temperatura de descarga 1ra etapa</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="ap_temp_descarga_1ra">
                      <select class="form-select form-select-sm unidad-select" data-tipo="temp"
                        name="ap_temp_descarga_1ra_unit"></select>
                    </div>
                  </div>
                  <!-- 6 -->
                  <div class="row align-items-center mb-2">
                    <div class="col-8 small">Presi√≥n de descarga 1ra etapa</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="ap_presion_descarga_1ra">
                      <select class="form-select form-select-sm unidad-select" data-tipo="presion"
                        name="ap_presion_descarga_1ra_unit"></select>
                    </div>
                  </div>
                  <!-- 7 -->
                  <div class="row align-items-center mb-2">
                    <div class="col-8 small">Temperatura de entrada 2da etapa</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="ap_temp_entrada_2da">
                      <select class="form-select form-select-sm unidad-select" data-tipo="temp"
                        name="ap_temp_entrada_2da_unit"></select>
                    </div>
                  </div>
                  <!-- 8 -->
                  <div class="row align-items-center mb-2">
                    <div class="col-8 small">Temperatura de descarga 2da etapa</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="ap_temp_descarga_2da">
                      <select class="form-select form-select-sm unidad-select" data-tipo="temp"
                        name="ap_temp_descarga_2da_unit"></select>
                    </div>
                  </div>
                  <!-- 9 -->
                  <div class="row align-items-center mb-2">
                    <div class="col-8 small">Presi√≥n de descarga 2da etapa</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="ap_presion_descarga_2da">
                      <select class="form-select form-select-sm unidad-select" data-tipo="presion"
                        name="ap_presion_descarga_2da_unit"></select>
                    </div>
                  </div>
                  <!-- 10 -->
                  <div class="row align-items-center mb-2">
                    <div class="col-8 small">Temperatura de entrada 3ra etapa</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="ap_temp_entrada_3ra">
                      <select class="form-select form-select-sm unidad-select" data-tipo="temp"
                        name="ap_temp_entrada_3ra_unit"></select>
                    </div>
                  </div>
                  <!-- 11 -->
                  <div class="row align-items-center mb-2">
                    <div class="col-8 small">Temperatura de descarga 3ra etapa</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="ap_temp_descarga_3ra">
                      <select class="form-select form-select-sm unidad-select" data-tipo="temp"
                        name="ap_temp_descarga_3ra_unit"></select>
                    </div>
                  </div>
                  <!-- 12 -->
                  <div class="row align-items-center">
                    <div class="col-8 small">Presi√≥n de descarga 3a etapa</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="ap_presion_descarga_3a">
                      <select class="form-select form-select-sm unidad-select" data-tipo="presion"
                        name="ap_presion_descarga_3a_unit"></select>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Datos el√©ctricos ¬∑ ALTA PRESI√ìN -->
          <div class="card p-3 mt-3" id="card_electrico_alta_presion" style="display:none;">
            <div class="fw-bold mb-2">Datos el√©ctricos</div>
            <div class="table-responsive">
              <table class="table table-bordered table-sm align-middle">
                <thead class="table-light">
                  <tr>
                    <th>MEDICI√ìN</th>
                    <th class="text-center">L1 / L1-2</th>
                    <th class="text-center">L2 / L2-3</th>
                    <th class="text-center">L3 / L3-1</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- Voltaje -->
                  <tr>
                    <th>Voltaje</th>
                    <td>
                      <div class="input-group input-group-sm">
                        <input class="form-control" name="ap_v_l12">
                        <select class="form-select unidad-select" name="ap_v_l12_u" data-tipo="voltaje"
                          style="max-width: 65px;"></select>
                      </div>
                    </td>
                    <td>
                      <div class="input-group input-group-sm">
                        <input class="form-control" name="ap_v_l23">
                        <select class="form-select unidad-select" name="ap_v_l23_u" data-tipo="voltaje"
                          style="max-width: 65px;"></select>
                      </div>
                    </td>
                    <td>
                      <div class="input-group input-group-sm">
                        <input class="form-control" name="ap_v_l31">
                        <select class="form-select unidad-select" name="ap_v_l31_u" data-tipo="voltaje"
                          style="max-width: 65px;"></select>
                      </div>
                    </td>
                  </tr>
                  <!-- Corriente de motor -->
                  <tr>
                    <th>Corriente de motor</th>
                    <td>
                      <div class="input-group input-group-sm">
                        <input class="form-control" name="ap_i_motor_l1">
                        <select class="form-select unidad-select" name="ap_i_motor_l1_u" data-tipo="amperaje"
                          style="max-width: 65px;"></select>
                      </div>
                    </td>
                    <td>
                      <div class="input-group input-group-sm">
                        <input class="form-control" name="ap_i_motor_l2">
                        <select class="form-select unidad-select" name="ap_i_motor_l2_u" data-tipo="amperaje"
                          style="max-width: 65px;"></select>
                      </div>
                    </td>
                    <td>
                      <div class="input-group input-group-sm">
                        <input class="form-control" name="ap_i_motor_l3">
                        <select class="form-select unidad-select" name="ap_i_motor_l3_u" data-tipo="amperaje"
                          style="max-width: 65px;"></select>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- ==========================
         Actividades (Preventivo ‚Äì Secador)
         Solo se mostrar√° v√≠a JS cuando:
         - tipo_servicio = Preventivo
         - tipo_equipo contiene "Secador"
         ========================== -->
        <div id="bloque_preventivo_secador" class="mb-4" style="display:none;">
          <div class="section-title mb-2">Actividades (Preventivo ‚Äì Secador)</div>

          <div class="row">
            <div class="col-12 col-md-6">
              <div class="form-check mb-2">
                <input class="form-check-input" type="checkbox" id="act_sec_rev_general" name="act_sec_rev_general"
                  value="1">
                <label class="form-check-label" for="act_sec_rev_general">
                  Revisi√≥n general del equipo
                </label>
              </div>

              <div class="form-check mb-2">
                <input class="form-check-input" type="checkbox" id="act_sec_reapriete_electrico"
                  name="act_sec_reapriete_electrico" value="1">
                <label class="form-check-label" for="act_sec_reapriete_electrico">
                  Reapriete de conexiones el√©ctricas
                </label>
              </div>

              <div class="form-check mb-2">
                <input class="form-check-input" type="checkbox" id="act_sec_reapriete_mecanico"
                  name="act_sec_reapriete_mecanico" value="1">
                <label class="form-check-label" for="act_sec_reapriete_mecanico">
                  Reapriete de conexiones mec√°nicas
                </label>
              </div>

              <div class="form-check mb-2">
                <input class="form-check-input" type="checkbox" id="act_sec_limpieza_general"
                  name="act_sec_limpieza_general" value="1">
                <label class="form-check-label" for="act_sec_limpieza_general">
                  Limpieza general del equipo
                </label>
              </div>
            </div>

            <div class="col-12 col-md-6">
              <div class="form-check mb-2">
                <input class="form-check-input" type="checkbox" id="act_sec_cambio_prefiltro"
                  name="act_sec_cambio_prefiltro" value="1">
                <label class="form-check-label" for="act_sec_cambio_prefiltro">
                  Cambio de prefiltro
                </label>
              </div>

              <div class="form-check mb-2">
                <input class="form-check-input" type="checkbox" id="act_sec_cambio_posfiltro"
                  name="act_sec_cambio_posfiltro" value="1">
                <label class="form-check-label" for="act_sec_cambio_posfiltro">
                  Cambio de pos filtro
                </label>
              </div>

              <div class="form-check mb-2">
                <input class="form-check-input" type="checkbox" id="act_sec_cambio_valvulas"
                  name="act_sec_cambio_valvulas" value="1">
                <label class="form-check-label" for="act_sec_cambio_valvulas">
                  Cambio de v√°lvulas
                </label>
              </div>
            </div>
          </div>

          <div class="mt-3">
            <label class="form-label">OTRAS ACTIVIDADES</label>
            <textarea class="form-control" name="otras_actividades_secador" rows="3"
              placeholder="Escribe aqu√≠..."></textarea>
          </div>
        </div>

        <!-- Correctivo / Diagn√≥stico / Revisi√≥n -->
        <div id="bloque_correctivo" class="mb-4" style="display:none;">
          <div class="section-title mb-2">Detalle del servicio</div>
          <div class="row g-3">
            <div class="col-12"><label class="form-label">Diagn√≥stico del problema</label><textarea class="form-control"
                name="diag_problema" rows="2"></textarea></div>
            <div class="col-12"><label class="form-label">Causa ra√≠z</label><textarea class="form-control"
                name="causa_raiz" rows="2"></textarea></div>
            <div class="col-12"><label class="form-label">Actividades realizadas</label><textarea class="form-control"
                name="actividades_realizadas" rows="2"></textarea></div>
            <div class="col-12"><label class="form-label">Refacciones utilizadas</label><textarea class="form-control"
                name="refacciones" rows="2"></textarea></div>
            <div class="col-12"><label class="form-label">Condiciones en que se encontr√≥ el equipo</label><textarea
                class="form-control" name="cond_encontro" rows="2"></textarea></div>
            <div class="col-12"><label class="form-label">Condiciones en que se entrega el equipo</label><textarea
                class="form-control" name="cond_entrega" rows="2"></textarea></div>
          </div>
        </div>
        <!-- ========== FIN SECCI√ìN 3 ========== -->

        <!-- ========== SECCI√ìN 4: Lecturas del equipo ========== -->
        <div class="form-section-step" data-section="4">
          <div class="mobile-section-title d-none d-block d-lg-none">
            <span class="section-number">4</span> Lecturas del Equipo
          </div>

        <!-- LECTURAS DEL EQUIPO -->
        <div class="mb-4">
          <div class="section-title mb-2">Lecturas del equipo</div>

          <!-- Lecturas ¬∑ COMPRESOR (vista normal) -->
          <div class="card shadow-sm border-0 mb-4" id="card_lecturas_compresor">
            <div class="row g-4">
              <!-- Datos generales -->
              <div class="col-12 col-lg-6">
                <div class="card p-3">
                  <div class="fw-bold mb-2">Datos generales</div>

                  <!-- 1 -->
                  <div class="row align-items-center mb-2">
                    <div class="col-8 small">Horas totales</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="dg_1">
                      <select class="form-select form-select-sm unidad-select" data-tipo="horas"
                        name="dg_1_unit"></select>
                    </div>
                  </div>
                  <!-- 2 -->
                  <div class="row align-items-center mb-2">
                    <div class="col-8 small">Horas de carga</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="dg_2">
                      <select class="form-select form-select-sm unidad-select" data-tipo="horas"
                        name="dg_2_unit"></select>
                    </div>
                  </div>
                  <!-- 3 -->
                  <div class="row align-items-center mb-2">
                    <div class="col-8 small">Presi√≥n objetivo/descarga</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="dg_3">
                      <select class="form-select form-select-sm unidad-select" data-tipo="presion"
                        name="dg_3_unit"></select>
                    </div>
                  </div>
                  <!-- 4 -->
                  <div class="row align-items-center mb-2">
                    <div class="col-8 small">Presi√≥n de carga</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="dg_4">
                      <select class="form-select form-select-sm unidad-select" data-tipo="presion"
                        name="dg_4_unit"></select>
                    </div>
                  </div>
                  <!-- 5 -->
                  <div class="row align-items-center mb-2">
                    <div class="col-8 small">Presi√≥n descarga del paquete</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="dg_5">
                      <select class="form-select form-select-sm unidad-select" data-tipo="presion"
                        name="dg_5_unit"></select>
                    </div>
                  </div>
                  <!-- 6 -->
                  <div class="row align-items-center mb-2">
                    <div class="col-8 small">Temperatura ambiente</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="dg_6">
                      <select class="form-select form-select-sm unidad-select" data-tipo="temp"
                        name="dg_6_unit"></select>
                    </div>
                  </div>
                  <!-- 7 -->
                  <div class="row align-items-center mb-2">
                    <div class="col-8 small">Temp. descarga del paquete</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="dg_7">
                      <select class="form-select form-select-sm unidad-select" data-tipo="temp"
                        name="dg_7_unit"></select>
                    </div>
                  </div>
                  <!-- 8 -->
                  <div class="row align-items-center mb-2">
                    <div class="col-8 small">Temp. descarga del aire-end</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="dg_8">
                      <select class="form-select form-select-sm unidad-select" data-tipo="temp"
                        name="dg_8_unit"></select>
                    </div>
                  </div>
                  <!-- 9 -->
                  <div class="row align-items-center mb-2">
                    <div class="col-8 small">Temp. inyecci√≥n de refrigerante</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="dg_9">
                      <select class="form-select form-select-sm unidad-select" data-tipo="temp"
                        name="dg_9_unit"></select>
                    </div>
                  </div>
                  <!-- 10 -->
                  <div class="row align-items-center">
                    <div class="col-8 small">Ca√≠da de presi√≥n separador</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="dg_10">
                      <select class="form-select form-select-sm unidad-select" data-tipo="presion"
                        name="dg_10_unit"></select>
                    </div>
                  </div>
                </div>
              </div>

              <!-- OIL FREE -->
              <div class="col-12 col-lg-6">
                <div class="card p-3" id="card_oilfree" style="display:none;">
                  <div class="fw-bold mb-2">Compresor (oil free)</div>

                  <div class="row align-items-center mb-2">
                    <div class="col-8 small">Temp. entrada aire 1ra etapa</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="of_1">
                      <select class="form-select form-select-sm unidad-select" data-tipo="temp"
                        name="of_1_unit"></select>
                    </div>
                  </div>
                  <div class="row align-items-center mb-2">
                    <div class="col-8 small">Temp. descarga aire 1ra etapa</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="of_2">
                      <select class="form-select form-select-sm unidad-select" data-tipo="temp"
                        name="of_2_unit"></select>
                    </div>
                  </div>
                  <div class="row align-items-center mb-2">
                    <div class="col-8 small">Presi√≥n descarga 1ra etapa</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="of_3">
                      <select class="form-select form-select-sm unidad-select" data-tipo="presion"
                        name="of_3_unit"></select>
                    </div>
                  </div>
                  <div class="row align-items-center mb-2">
                    <div class="col-8 small">Temp. entrada 2da etapa</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="of_4">
                      <select class="form-select form-select-sm unidad-select" data-tipo="temp"
                        name="of_4_unit"></select>
                    </div>
                  </div>
                  <div class="row align-items-center mb-2">
                    <div class="col-8 small">Temp. descarga 2da etapa</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="of_5">
                      <select class="form-select form-select-sm unidad-select" data-tipo="temp"
                        name="of_5_unit"></select>
                    </div>
                  </div>
                  <div class="row align-items-center mb-2">
                    <div class="col-8 small">Presi√≥n descarga 2da etapa</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="of_6">
                      <select class="form-select form-select-sm unidad-select" data-tipo="presion"
                        name="of_6_unit"></select>
                    </div>
                  </div>
                  <div class="row align-items-center mb-2">
                    <div class="col-8 small">Temperatura del aceite</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="of_7">
                      <select class="form-select form-select-sm unidad-select" data-tipo="temp"
                        name="of_7_unit"></select>
                    </div>
                  </div>
                  <div class="row align-items-center mb-2">
                    <div class="col-8 small">Presi√≥n de aceite</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="of_8">
                      <select class="form-select form-select-sm unidad-select" data-tipo="presion"
                        name="of_8_unit"></select>
                    </div>
                  </div>
                  <div class="row align-items-center mb-2">
                    <div class="col-8 small">Vac√≠o de entrada</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="of_9">
                      <select class="form-select form-select-sm unidad-select" data-tipo="presion"
                        name="of_9_unit"></select>
                    </div>
                  </div>
                  <div class="row align-items-center">
                    <div class="col-8 small">(otro)</div>
                    <div class="col-4 d-flex gap-2">
                      <input class="form-control form-control-sm" name="of_10">
                      <select class="form-select form-select-sm unidad-select" name="of_10_unit">
                        <option value="">‚Äî</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Lecturas ¬∑ SECADOR -->
          <div class="card shadow-sm border-0 p-3 mb-4" id="card_lecturas_secador" style="display:none;">
            <div class="row g-3">
              <!-- Temperatura de aire de entrada -->
              <div class="col-12 col-md-6 d-flex align-items-center">
                <div class="me-2 flex-grow-1">
                  <label class="form-label mb-0">Temperatura de aire de entrada</label>
                </div>
                <div class="me-2" style="width:120px;">
                  <input class="form-control form-control-sm" name="sec_temp_aire_entrada">
                </div>
                <div style="width:90px;">
                  <select class="form-select form-select-sm unidad-select" name="sec_temp_aire_entrada_u"
                    data-tipo="temp"></select>
                </div>
              </div>

              <!-- Temperatura de aire de salida -->
              <div class="col-12 col-md-6 d-flex align-items-center">
                <div class="me-2 flex-grow-1">
                  <label class="form-label mb-0">Temperatura de aire de salida</label>
                </div>
                <div class="me-2" style="width:120px;">
                  <input class="form-control form-control-sm" name="sec_temp_aire_salida">
                </div>
                <div style="width:90px;">
                  <select class="form-select form-select-sm unidad-select" name="sec_temp_aire_salida_u"
                    data-tipo="temp"></select>
                </div>
              </div>

              <!-- Temperatura del calentador -->
              <div class="col-12 col-md-6 d-flex align-items-center">
                <div class="me-2 flex-grow-1">
                  <label class="form-label mb-0">Temperatura del calentador</label>
                </div>
                <div class="me-2" style="width:120px;">
                  <input class="form-control form-control-sm" name="sec_temp_calentador">
                </div>
                <div style="width:90px;">
                  <select class="form-select form-select-sm unidad-select" name="sec_temp_calentador_u"
                    data-tipo="temp"></select>
                </div>
              </div>

              <!-- Temperatura ambiente -->
              <div class="col-12 col-md-6 d-flex align-items-center">
                <div class="me-2 flex-grow-1">
                  <label class="form-label mb-0">Temperatura ambiente</label>
                </div>
                <div class="me-2" style="width:120px;">
                  <input class="form-control form-control-sm" name="sec_temp_ambiente">
                </div>
                <div style="width:90px;">
                  <select class="form-select form-select-sm unidad-select" name="sec_temp_ambiente_u"
                    data-tipo="temp"></select>
                </div>
              </div>

              <!-- Punto de roc√≠o -->
              <div class="col-12 col-md-6 d-flex align-items-center">
                <div class="me-2 flex-grow-1">
                  <label class="form-label mb-0">Punto de roc√≠o</label>
                </div>
                <div class="me-2" style="width:120px;">
                  <input class="form-control form-control-sm" name="sec_punto_rocio">
                </div>
                <div style="width:90px;">
                  <select class="form-select form-select-sm unidad-select" name="sec_punto_rocio_u"
                    data-tipo="temp"></select>
                </div>
              </div>

              <!-- Tiempo de ciclo -->
              <div class="col-12 col-md-6 d-flex align-items-center">
                <div class="me-2 flex-grow-1">
                  <label class="form-label mb-0">Tiempo de ciclo</label>
                </div>
                <div class="me-2" style="width:120px;">
                  <input class="form-control form-control-sm" name="sec_tiempo_ciclo" placeholder="Ej. 5 min">
                </div>
                <div style="width:90px;"></div>
              </div>

              <!-- Horas totales -->
              <div class="col-12 col-md-6 d-flex align-items-center">
                <div class="me-2 flex-grow-1">
                  <label class="form-label mb-0">Horas totales</label>
                </div>
                <div class="me-2" style="width:120px;">
                  <input class="form-control form-control-sm" name="sec_horas_totales">
                </div>
                <div style="width:90px;">
                  <select class="form-select form-select-sm unidad-select" name="sec_horas_totales_u"
                    data-tipo="horas"></select>
                </div>
              </div>
            </div>

            <hr class="my-4">

            <div class="row g-3">
              <div class="col-12 col-md-6">
                <label class="form-label">Condiciones de prefiltro</label>
                <textarea class="form-control" name="sec_condicion_prefiltro" rows="2"
                  placeholder="Ej. Limpio / saturado / reemplazado..."></textarea>
              </div>
              <div class="col-12 col-md-6">
                <label class="form-label">Condiciones de pos filtro</label>
                <textarea class="form-control" name="sec_condicion_posfiltro" rows="2"
                  placeholder="Ej. Limpio / saturado / reemplazado..."></textarea>
              </div>
            </div>
          </div>
        </div>
        <!-- ========== FIN SECCI√ìN 4 ========== -->

        <!-- ========== SECCI√ìN 5: Datos el√©ctricos ========== -->
        <div class="form-section-step" data-section="5">
          <div class="mobile-section-title d-none d-block d-lg-none">
            <span class="section-number">5</span> Datos El√©ctricos
          </div>

          <!-- Datos el√©ctricos ¬∑ COMPRESOR (vista normal) -->
          <div class="card p-3 mt-3" id="card_electrico_compresor">
            <div class="fw-bold mb-2">Datos el√©ctricos</div>
            <div class="table-responsive">
              <table class="table table-bordered table-sm align-middle">
                <thead class="table-light">
                  <tr>
                    <th>MEDICI√ìN</th>
                    <th class="text-center">L1 / L1-2</th>
                    <th class="text-center">L2 / L2-3</th>
                    <th class="text-center">L3 / L3-1</th>
                  </tr>
                </thead>
                <tbody>
                  {% for titulo, key in e3 %}
                  {% set u_type = 'voltaje' if key.startswith('v_') else 'amperaje' %}
                  <tr>
                    <th>{{ titulo }}</th>
                    {% if key in ['v_carga','v_descarga'] %}
                    <td>
                      <div class="input-group input-group-sm">
                        <input class="form-control" name="{{ key }}_l12">
                        <select class="form-select unidad-select" name="{{ key }}_l12_u" data-tipo="{{ u_type }}"
                          style="max-width: 65px;"></select>
                      </div>
                    </td>
                    <td>
                      <div class="input-group input-group-sm">
                        <input class="form-control" name="{{ key }}_l23">
                        <select class="form-select unidad-select" name="{{ key }}_l23_u" data-tipo="{{ u_type }}"
                          style="max-width: 65px;"></select>
                      </div>
                    </td>
                    <td>
                      <div class="input-group input-group-sm">
                        <input class="form-control" name="{{ key }}_l31">
                        <select class="form-select unidad-select" name="{{ key }}_l31_u" data-tipo="{{ u_type }}"
                          style="max-width: 65px;"></select>
                      </div>
                    </td>
                    {% else %}
                    <td>
                      <div class="input-group input-group-sm">
                        <input class="form-control" name="{{ key }}_l1">
                        <select class="form-select unidad-select" name="{{ key }}_l1_u" data-tipo="{{ u_type }}"
                          style="max-width: 65px;"></select>
                      </div>
                    </td>
                    <td>
                      <div class="input-group input-group-sm">
                        <input class="form-control" name="{{ key }}_l2">
                        <select class="form-select unidad-select" name="{{ key }}_l2_u" data-tipo="{{ u_type }}"
                          style="max-width: 65px;"></select>
                      </div>
                    </td>
                    <td>
                      <div class="input-group input-group-sm">
                        <input class="form-control" name="{{ key }}_l3">
                        <select class="form-select unidad-select" name="{{ key }}_l3_u" data-tipo="{{ u_type }}"
                          style="max-width: 65px;"></select>
                      </div>
                    </td>
                    {% endif %}
                  </tr>
                  {% endfor %}
                  {% for titulo, key in e1 %}
                  {% if 'rpm' in key %}
                  {% set u_type = 'frecuencia' %}
                  {% elif key.startswith('v_') %}
                  {% set u_type = 'voltaje' %}
                  {% elif key.startswith('i_') %}
                  {% set u_type = 'amperaje' %}
                  {% elif key.startswith('t_') %}
                  {% set u_type = 'temp' %}
                  {% else %}
                  {% set u_type = 'otro' %}
                  {% endif %}
                  <tr>
                    <th>{{ titulo }}</th>
                    <td colspan="3">
                      <div class="input-group input-group-sm">
                        <input class="form-control" name="{{ key }}">
                        <select class="form-select unidad-select" name="{{ key }}_u" data-tipo="{{ u_type }}"
                          style="max-width: 65px;"></select>
                      </div>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>

          <!-- Datos el√©ctricos ¬∑ SECADOR (solo 6 valores) -->
          <div class="card p-3 mt-3" id="card_electrico_secador" style="display:none;">
            <div class="fw-bold mb-2">Datos el√©ctricos</div>
            <div class="table-responsive">
              <table class="table table-bordered table-sm align-middle">
                <thead class="table-light">
                  <tr>
                    <th>MEDICI√ìN</th>
                    <th class="text-center">L1 / L1-2</th>
                    <th class="text-center">L2 / L2-3</th>
                    <th class="text-center">L3 / L3-1</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- Corriente en carga (L1, L2, L3) - SECADOR -->
                  <tr>
                    <th>Corriente en carga</th>
                    <td>
                      <div class="input-group input-group-sm">
                        <input class="form-control" name="sec_i_carga_l1">
                        <select class="form-select unidad-select" name="sec_i_carga_l1_u" data-tipo="amperaje"
                          style="max-width: 65px;"></select>
                      </div>
                    </td>
                    <td>
                      <div class="input-group input-group-sm">
                        <input class="form-control" name="sec_i_carga_l2">
                        <select class="form-select unidad-select" name="sec_i_carga_l2_u" data-tipo="amperaje"
                          style="max-width: 65px;"></select>
                      </div>
                    </td>
                    <td>
                      <div class="input-group input-group-sm">
                        <input class="form-control" name="sec_i_carga_l3">
                        <select class="form-select unidad-select" name="sec_i_carga_l3_u" data-tipo="amperaje"
                          style="max-width: 65px;"></select>
                      </div>
                    </td>
                  </tr>

                  <!-- Voltaje en carga (L1-L2, L2-L3, L1-L3) - SECADOR -->
                  <tr>
                    <th>Voltaje en carga</th>
                    <td>
                      <div class="input-group input-group-sm">
                        <input class="form-control" name="sec_v_carga_l12">
                        <select class="form-select unidad-select" name="sec_v_carga_l12_u" data-tipo="voltaje"
                          style="max-width: 65px;"></select>
                      </div>
                    </td>
                    <td>
                      <div class="input-group input-group-sm">
                        <input class="form-control" name="sec_v_carga_l23">
                        <select class="form-select unidad-select" name="sec_v_carga_l23_u" data-tipo="voltaje"
                          style="max-width: 65px;"></select>
                      </div>
                    </td>
                    <td>
                      <div class="input-group input-group-sm">
                        <input class="form-control" name="sec_v_carga_l31">
                        <select class="form-select unidad-select" name="sec_v_carga_l31_u" data-tipo="voltaje"
                          style="max-width: 65px;"></select>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <!-- ========== FIN SECCI√ìN 5 ========== -->

        <!-- ========== SECCI√ìN 6: Observaciones, Fotos, Firmas ========== -->
        <div class="form-section-step" data-section="6">
          <div class="mobile-section-title d-none d-block d-lg-none">
            <span class="section-number">6</span> Finalizar Reporte
          </div>

        <!-- Observaciones -->
        <div class="mb-4">
          <div class="section-title mb-2">Observaciones y recomendaciones</div>
          <textarea class="form-control" name="observaciones" rows="3"></textarea>
        </div>

        <!-- Fotos -->
        <div class="mb-4">
          <div class="section-title mb-2">Evidencias fotogr√°ficas <span id="fotos_hint">(m√°x. 4)</span></div>
          <div class="row g-3" id="fotos_grid">
            {% for i in range(1,5) %}
            <div class="col-12 col-md-6 foto-item" data-index="{{ i }}">
              <div class="form-text mb-1">Foto {{ i }}</div>
              <input class="form-control" type="file" accept="image/*" name="foto{{i}}">
              <input class="form-control mt-2" name="foto{{i}}_desc" placeholder="Descripci√≥n">
            </div>
            {% endfor %}
          </div>
        </div>

        <!-- Firmas -->
        <div class="mb-4">
          <div class="section-title mb-2">Firmas</div>
          <div class="row g-3">
            <div class="col-12 col-md-6">
              <div class="sig-box p-2">
                <canvas id="firma_tecnico_canvas" style="width:100%; height:120px;"></canvas>
              </div>
              <div class="mt-2 d-flex gap-2">
                <input class="form-control" name="firma_tecnico_nombre" placeholder="Nombre del t√©cnico">
                <button type="button" id="btn_clear_tecnico" class="btn btn-outline-secondary">Borrar</button>
              </div>
              <input type="hidden" id="firma_tecnico_data" name="firma_tecnico_data">
            </div>
            <div class="col-12 col-md-6">
              <div class="sig-box p-2">
                <canvas id="firma_cliente_canvas" style="width:100%; height:120px;"></canvas>
              </div>
              <div class="mt-2 d-flex gap-2">
                <input class="form-control" name="firma_cliente_nombre" placeholder="Nombre del cliente">
                <button type="button" id="btn_clear_cliente" class="btn btn-outline-secondary">Borrar</button>
              </div>
              <input type="hidden" id="firma_cliente_data" name="firma_cliente_data">
            </div>
          </div>
        </div>

        <!-- ‚úÖ Bot√≥n para limpiar borrador + Generar PDF -->
        <div class="d-flex justify-content-end gap-2 desktop-only-buttons">
          <button type="button" id="btn-clear-draft" class="btn btn-outline-secondary">Borrar borrador</button>
          <button class="btn btn-primary px-4">Generar PDF</button>
        </div>
        </div>
        <!-- ========== FIN SECCI√ìN 6 ========== -->

      </form>
    </div>

    <!-- Navegaci√≥n por secciones (solo m√≥vil/tablet) -->
    <div class="mobile-section-nav" style="display:flex !important; position:fixed !important; bottom:0 !important; left:0 !important; right:0 !important; background:#fff !important; padding:15px !important; border-top:2px solid #d20000 !important; z-index:99999 !important;">
      <button type="button" class="btn btn-outline-secondary" id="btn-prev-section" onclick="navigateSection(-1)" disabled style="flex:1; max-width:120px;">
        ‚Üê Anterior
      </button>
      <span style="font-weight:600; color:#333;">
        <span id="currentSectionNum">1</span> / <span id="totalSections">6</span>
      </span>
      <button type="button" class="btn btn-primary" id="btn-next-section" onclick="navigateSection(1)" style="flex:1; max-width:120px;">
        Siguiente ‚Üí
      </button>
    </div>
  </div>

    <!-- Exponemos el folio para el JS (auto-guardado/borradores) -->
    <script>
      window.__FOLIO__ = "{{ folio }}";
    </script>


    <!-- Bootstrap JS (necesario para el modal) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Tu JS con auto-guardado, SPM/R30, Oil-Free, firmas, etc. -->
    <!-- Scripts (orden importante) -->
    <script src="{{ url_for('static', filename='js/cliente_autofill.js') }}"></script>
    <script src="{{ url_for('static', filename='js/interactividad.js') }}"></script>

    <!-- Navegaci√≥n por secciones (SOLO vista m√≥vil/tablet, no afecta l√≥gica) -->
    <script>
    (function() {
      // Solo activar en m√≥vil/tablet
      const MOBILE_BREAKPOINT = 992;
      let currentSection = 1;
      const totalSections = 6;

      function isMobileView() {
        return window.innerWidth <= MOBILE_BREAKPOINT;
      }

      function updateNavBar() {
        // El CSS ya maneja la visibilidad con media queries
        // No necesitamos hacer nada aqu√≠
      }

      function updateSectionVisibility() {
        updateNavBar();
        
        if (!isMobileView()) {
          // Desktop: mostrar todas las secciones
          document.querySelectorAll('.form-section-step').forEach(s => {
            s.classList.add('active');
            s.style.display = '';
          });
          return;
        }

        // M√≥vil: mostrar solo la secci√≥n actual
        document.querySelectorAll('.form-section-step').forEach(s => {
          const sectionNum = parseInt(s.dataset.section);
          if (sectionNum === currentSection) {
            s.classList.add('active');
          } else {
            s.classList.remove('active');
          }
        });

        // Actualizar indicador
        const currentNumEl = document.getElementById('currentSectionNum');
        if (currentNumEl) currentNumEl.textContent = currentSection;

        // Actualizar botones
        const btnPrev = document.getElementById('btn-prev-section');
        const btnNext = document.getElementById('btn-next-section');
        
        if (btnPrev) btnPrev.disabled = currentSection === 1;
        
        if (btnNext) {
          if (currentSection === totalSections) {
            btnNext.textContent = 'Generar PDF';
            btnNext.classList.remove('btn-primary');
            btnNext.classList.add('btn-success');
          } else {
            btnNext.textContent = 'Siguiente ‚Üí';
            btnNext.classList.remove('btn-success');
            btnNext.classList.add('btn-primary');
          }
        }

        // Scroll al inicio de la secci√≥n
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }

      window.navigateSection = function(direction) {
        if (!isMobileView()) return;

        const newSection = currentSection + direction;
        
        // Si est√° en la √∫ltima secci√≥n y presiona "Generar PDF"
        if (currentSection === totalSections && direction === 1) {
          // Enviar el formulario
          const form = document.getElementById('frm-reporte');
          if (form) form.submit();
          return;
        }

        if (newSection >= 1 && newSection <= totalSections) {
          currentSection = newSection;
          updateSectionVisibility();
        }
      };

      // Inicializar al cargar
      document.addEventListener('DOMContentLoaded', function() {
        updateSectionVisibility();
      });

      // Re-evaluar al cambiar tama√±o de ventana
      window.addEventListener('resize', function() {
        updateSectionVisibility();
      });
    })();
    </script>
</body>

</html>